<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/css/bootstrap.css">
    <title>Banned Words</title>
</head>
<body>

    <div class="container d-flex flex-column align-items-center my-5 vh-100">

        <div class="row w-75 mb-5 border rounded m-3 p-3 border-primary">

            Step 1: Save all banned words. Seperate each banned word with a space or comma. For phrases, please use  single or double quotes.
            
        </div>

        <!-- Enter Banned Words Section -->

        <div class="row w-75 mb-5">

            <div class="col-sm-12 col-md">
                <form>
                    <div class="form-group ">
                        <label for="originalText">Enter Banned Words</label>
                        <textarea class="form-control" id="bannedText" rows="5" placeholder="Enter Banned Words Here..." ></textarea>
                    </div>
                </form>

            </div>

            <div class="col-md-2 d-flex flex-column justify-content-center">
                <button id="submitBW" type="button" onclick="saveBannedWords()" class="btn btn-primary h-30">Save Words</button>

            </div>

        </div>

        <div class="row w-75 mb-5">
            
            <div class="col-sm-12 col-md">

                <label for="bannedText">Banned Words List</label>

                <div id="noBannedWords" class="border p-3">
                    <p>
                        No banned words have been added yet
                    </p>
                </div>

                <div id="dislayBannedWords" class="d-none">
                    <ul id="bannedList" class="list-group list-group-horizontal">
                </div>
                

                </ul>
            </div>

        </div>



        <!-- Add and Update Document Section -->

        <div class="row w-75 mb-5 border rounded m-3 p-3 border-primary">
            Step 2: Add text to filter out banned words and click submit.
        </div>

        <div class="row w-75">

            <div class="col-sm-12 col-md">
                <form>
                    <div class="form-group ">
                        <label for="originalText">Original Document Text</label>
                        <textarea class="form-control" id="originalText" rows="12" placeholder="Enter Text Here..." ></textarea>
                    </div>
                </form>
            </div>

            <div class="col-md-2 d-flex flex-column justify-content-center">
                <button id="submit" type="button" onclick="updateDocument()" class="btn btn-primary h-30">Submit</button>
            </div>

            <div class="col-sm-12 col-md">
                <form>
                    <div class="form-group ">
                        <label for="updatedText">Updated Document</label>
                        <textarea class="form-control" id="updatedText" rows="12" readonly></textarea>
                    </div>
                </form>
            </div>

        </div>

    </div>
</body>

<script>

    let bannedWords = "";
    let regxBannedWords = "";
    let stringToBeEdited = "";

    function saveBannedWords(){

        document.getElementById("bannedList").innerHTML = "";

        // Alert if no banned word saved when save button is clicked
        if(document.getElementById("bannedText").value == ""){
            alert("Please add at least one banned word.");
            return;
        }
        
        bannedWords = document.getElementById("bannedText").value;
        let regxString = /([\w!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]\S*)|("([^"]|"")*")|('([^']|'')*')/g;
        regxBannedWords = bannedWords.match(regxString);
        document.getElementById("bannedText").value = "";

        let noBannedText = document.getElementById("noBannedWords");
        let displayBannedText= document.getElementById("dislayBannedWords")

        noBannedText.classList.add("d-none");
        displayBannedText.classList.remove("d-none");

        for(i = 0; i < regxBannedWords.length; i++){

            let ul = document.getElementById("bannedList");
            let li = document.createElement("li");

            if(regxBannedWords[i].split('\"').length > 2 || regxBannedWords[i].split('\'').length > 2){
                if(regxBannedWords[i].includes('\"')){
                    regxBannedWords[i] = regxBannedWords[i].replace(/\"*/g,"");
                } else if(regxBannedWords[i].includes("\'")){
                    regxBannedWords[i] = regxBannedWords[i].replace(/\'*/g,"");
                }
            }

            li.appendChild(document.createTextNode(regxBannedWords[i]));
            li.setAttribute("class", "list-group-item");
            ul.appendChild(li);

        }
    }

    function updateDocument(){

        stringToBeEdited = document.getElementById("originalText").value;

        // Alert if no words are saved
        if(regxBannedWords == ""){
            alert("No banned words saved.");
        }

        for(i = 0; i < regxBannedWords.length; i++){

            let removeStr = regxBannedWords[i];

            // Account for Special Characters
            const specialChar = new RegExp(/([.^$*+?()[{\|])/g);
            const specialCharStr = "[.^$*+?()[{\|]";

            if(specialChar.test(removeStr)){

                // console.log("step 1: " + removeStr + " contains special character.")

                for(i = 0; i < specialCharStr.length; i++){
                    if(removeStr.includes(specialCharStr[i])){
                        removeStr = removeStr.replace(specialChar, "\\" + specialCharStr[i]);
                    }

                }
                // console.log("Step 1b: after special char code: " + removeStr);
                
            }


            // Remove Single or Double Quotes
            if(removeStr.split('\"').length > 2 || removeStr.split('\'').length > 2){

                if(removeStr.includes('\"')){
                    removeStr = removeStr.replace(/\"*/g,"");
                    // console.log("step 2; removing double quotes");
                } else if(removeStr.includes("\'")){
                    removeStr = removeStr.replace(/\'*/,"");
                    // console.log("step 2; removing single quotes");
                }
            }


            // Determine if a banned word is one word or a phrase
            if(removeStr.split(' ').length > 1){
                const rgx = new RegExp("\\b" + removeStr, 'gi');
                stringToBeEdited = stringToBeEdited.replace(rgx, "XXXX");
                // console.log("step 3: phrase contains more than one word: " + rgx);
            } else {
                const rgx = new RegExp("\\b" + removeStr + "+", 'gi');
                stringToBeEdited = stringToBeEdited.replace(rgx, "XXXX");
                // console.log("step 3: phrase contains only one word: " +rgx);
                console.log(stringToBeEdited);
            }

            
            // console.log("removeStr end result: " + removeStr);
        
        }

        // console.log("stringToBeEdited end result: " + stringToBeEdited);

        document.getElementById("updatedText").innerHTML = stringToBeEdited;

    }

</script>
</html>